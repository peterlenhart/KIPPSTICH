<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kippstich â€“ BoxBot Prototype</title>
  <style>
    :root{
      --bg:#0f1115;
      --panel:#151924;
      --text:#e9ecf1;
      --muted:#a8b0bf;
      --line:#2a3142;
      --btn:#222a3a;
      --btn2:#2b3550;
      --danger:#ff4d4d;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
    body{margin:0;background:var(--bg);color:var(--text);}

    .wrap{max-width:980px;margin:0 auto;padding:18px;}
    header{display:flex;gap:12px;align-items:flex-end;justify-content:space-between;flex-wrap:wrap;}
    h1{margin:0;font-size:20px;letter-spacing:.2px;}
    .sub{color:var(--muted);font-size:13px;margin-top:4px}

    .row{display:grid;grid-template-columns: 1.2fr .8fr;gap:14px;margin-top:14px;}
    @media (max-width:900px){ .row{grid-template-columns:1fr;} }

    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px;}
    .card h2{margin:0 0 10px 0;font-size:14px;color:var(--muted);font-weight:600;letter-spacing:.2px;}
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    button{
      background:var(--btn);border:1px solid var(--line);color:var(--text);
      border-radius:12px;padding:10px 12px;font-size:14px;cursor:pointer;
    }
    button:hover{background:var(--btn2);}
    button:disabled{opacity:.5;cursor:not-allowed;}
    .pill{padding:8px 10px;border-radius:999px;border:1px solid var(--line);color:var(--muted);font-size:13px;}

    /* Play area */
    .play-area{display:grid;grid-template-columns: 1fr;gap:14px;}
    .stack-area{display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap;}
    .stack-col{flex:1;min-width:280px;}
    .stack-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
    .totals{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}

    /* Cards */
    .stack{
      position:relative;
      min-height:190px;
      border:1px dashed #2f3850;
      border-radius:14px;
      padding:12px;
      overflow:hidden;
      background:rgba(255,255,255,0.02);
    }
    .kcard{
      width:120px;height:120px;border-radius:16px;
      display:flex;align-items:center;justify-content:center;
      position:absolute;
      box-shadow:0 10px 22px rgba(0,0,0,.35);
      border:2px solid rgba(0,0,0,.15);
      user-select:none;
    }
    .knum{
      font-size:54px;
      font-weight:800;
      color:#000; /* schwarze Ziffer wie gewÃ¼nscht */
      line-height:1;
    }
    .tag{
      position:absolute;bottom:8px;left:10px;
      font-size:12px;color:rgba(0,0,0,.6);
      font-weight:700;letter-spacing:.4px;
      text-transform:uppercase;
    }

    /* Super card box */
    .superBox{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background:rgba(255,255,255,0.02);
    }
    .superHead{
      display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;
    }
    .xbtn{
      width:38px;height:38px;border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,0.04);
      display:flex;align-items:center;justify-content:center;
      font-size:18px;color:var(--text);
      cursor:pointer;
    }
    .xbtn:hover{border-color:var(--danger);color:var(--danger);}
    .superHint{color:var(--muted);font-size:13px;margin:0 0 10px 0;}
    .superCardWrap{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
    .superCardWrap .kcard{position:relative;cursor:pointer;}
    .superCardWrap .kcard:hover{transform:translateY(-2px);}

    /* Number grid 1-12: 4 per row */
    .grid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }
    .num{
      background:#101421;border:1px solid var(--line);
      border-radius:14px;
      padding:14px 0;
      font-size:18px;
      font-weight:800;
      text-align:center;
      cursor:pointer;
      user-select:none;
    }
    .num:hover{background:#151c2c;}
    .num:active{transform:translateY(1px);}
    .small{font-size:12px;color:var(--muted);margin-top:10px;line-height:1.35}

    /* End screen */
    .overlay{
      position:fixed;inset:0;background:rgba(0,0,0,.7);
      display:none;align-items:center;justify-content:center;padding:18px;
    }
    .modal{
      max-width:520px;width:100%;
      background:var(--panel);border:1px solid var(--line);border-radius:16px;
      padding:18px;
    }
    .modal h3{margin:0 0 8px 0;}
    .modal p{margin:0;color:var(--muted);line-height:1.4}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Kippstich â€“ BoxBot (Prototyp)</h1>
        <div class="sub">Startkarte â†’ Kippstiche â†’ optional Superkipp â†’ Punkte bis 140</div>
      </div>
      <div class="totals">
        <div class="pill">BoxBot: <b id="boxSum">0</b></div>
        <div class="pill">Gewonnene Punkte: <b id="score">0</b> / 140</div>
      </div>
    </header>

    <div class="row">
      <section class="card">
        <h2>Aktionen</h2>
        <div class="controls">
          <button id="btnStart">Startkarte generieren</button>
          <button id="btnSuper" disabled>Superkipp (Karte generieren)</button>
          <button id="btnReset">Alles zurÃ¼cksetzen</button>
          <span class="pill" id="chainInfo">Kettenfarbe: â€“</span>
        </div>
        <div class="small">
          <b>Kippstich:</b> Klick auf eine Zahl (1â€“12) â†’ Karte in derselben Kettenfarbe wird in den BoxBot gelegt.<br>
          <b>Superkipp:</b> erzeugt eine zusÃ¤tzliche Karte in anderer Farbe. Klick auf die Superkippkarte = Erfolg (BoxBot als Punkte). âœ• = Misserfolg (unterste BoxBot-Karte entfernen).
        </div>
      </section>

      <section class="card">
        <h2>Zahlenblock (1â€“12)</h2>
        <div class="grid" id="numGrid"></div>
        <div class="small">
          Tipp: Hier klickst du den Wert an, mit dem du â€ždrÃ¼ber gestochenâ€œ hast (Kippstich).
        </div>
      </section>
    </div>

    <div class="row">
      <section class="card">
        <h2>BoxBot (KartenfÃ¤cher)</h2>
        <div class="stack-area">
          <div class="stack-col">
            <div class="stack-title">
              <div class="pill">Karten im BoxBot: <b id="cardCount">0</b></div>
              <div class="pill">Letzter Wert: <b id="lastVal">â€“</b></div>
            </div>
            <div class="stack" id="stack"></div>
          </div>

          <div class="stack-col">
            <div class="stack-title">
              <div class="pill">Superkipp</div>
              <div class="pill">Status: <b id="superStatus">â€“</b></div>
            </div>
            <div class="superBox">
              <div class="superHead">
                <div class="superHint">Wenn eine Superkippkarte aktiv ist: Klick = Erfolg, âœ• = Misserfolg.</div>
                <div class="xbtn" id="xFail" title="Superkipp verfehlt (unterste Karte entfernen)">âœ•</div>
              </div>
              <div class="superCardWrap" id="superWrap"></div>
            </div>
          </div>
        </div>
      </section>
    </div>

  </div>

  <div class="overlay" id="overlay">
    <div class="modal">
      <h3>Spielende ðŸŽ¯</h3>
      <p>Du hast <b id="finalScore">140</b> Punkte erreicht. (Ziel: 140)</p>
      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
        <button id="btnNewGame">Neues Spiel</button>
      </div>
    </div>
  </div>

<script>
  // Farben (deine fixierten RGBs)
  const COLORS = [
    { name: "GrÃ¼n",    css: "rgb(0, 166, 82)" },
    { name: "Orange",  css: "rgb(249, 150, 30)" }, // dein damaliges "Gelb" -> wirkt orange
    { name: "Violett", css: "rgb(164, 27, 133)" },
    { name: "Blau",    css: "rgb(0, 107, 179)" },
  ];

  const SCORE_TARGET = 140;

  // State
  let chainColor = null;        // index in COLORS
  let boxCards = [];            // [{value, colorIndex, type:'start'|'stich'|'super'}]
  let score = 0;

  let superCard = null;         // {value, colorIndex} or null

  // DOM
  const elBoxSum = document.getElementById("boxSum");
  const elScore = document.getElementById("score");
  const elChainInfo = document.getElementById("chainInfo");

  const elStack = document.getElementById("stack");
  const elCount = document.getElementById("cardCount");
  const elLastVal = document.getElementById("lastVal");

  const btnStart = document.getElementById("btnStart");
  const btnSuper = document.getElementById("btnSuper");
  const btnReset = document.getElementById("btnReset");

  const elSuperWrap = document.getElementById("superWrap");
  const elSuperStatus = document.getElementById("superStatus");
  const xFail = document.getElementById("xFail");

  const overlay = document.getElementById("overlay");
  const finalScore = document.getElementById("finalScore");
  const btnNewGame = document.getElementById("btnNewGame");

  // Build number grid (1..12)
  const grid = document.getElementById("numGrid");
  for(let i=1;i<=12;i++){
    const d = document.createElement("div");
    d.className = "num";
    d.textContent = i;
    d.addEventListener("click", ()=> onNumberClick(i));
    grid.appendChild(d);
  }

  function randInt(min, max){
    return Math.floor(Math.random()*(max-min+1))+min;
  }
  function pickRandomColorIndex(excludeIndex=null){
    const options = COLORS.map((_,i)=>i).filter(i=>i!==excludeIndex);
    return options[randInt(0, options.length-1)];
  }

  function boxSum(){
    return boxCards.reduce((a,c)=>a+c.value,0);
  }

  function updateUI(){
    elBoxSum.textContent = boxSum();
    elScore.textContent = score;
    elCount.textContent = boxCards.length;
    elLastVal.textContent = boxCards.length ? boxCards[boxCards.length-1].value : "â€“";
    elChainInfo.innerHTML = `Kettenfarbe: <b>${chainColor===null ? "â€“" : COLORS[chainColor].name}</b>`;

    // Enable rules
    btnSuper.disabled = (chainColor===null || boxCards.length===0 || superCard!==null);

    // Render stack
    elStack.innerHTML = "";
    const baseX = 10, baseY = 10;
    const dx = 14, dy = 14; // fÃ¤cher
    const maxShow = 9; // optisch
    const startIdx = Math.max(0, boxCards.length - maxShow);

    for(let i=startIdx;i<boxCards.length;i++){
      const c = boxCards[i];
      const k = document.createElement("div");
      k.className = "kcard";
      k.style.background = COLORS[c.colorIndex].css;
      const pos = i - startIdx;
      k.style.left = (baseX + pos*dx) + "px";
      k.style.top  = (baseY + pos*dy) + "px";

      const num = document.createElement("div");
      num.className = "knum";
      num.textContent = c.value;

      const tag = document.createElement("div");
      tag.className = "tag";
      tag.textContent = c.type === "start" ? "Start" : (c.type === "super" ? "Super" : "Stich");

      k.appendChild(num);
      k.appendChild(tag);
      elStack.appendChild(k);
    }

    // Render super card
    elSuperWrap.innerHTML = "";
    if(superCard){
      elSuperStatus.textContent = "aktiv";
      const k = document.createElement("div");
      k.className = "kcard";
      k.style.background = COLORS[superCard.colorIndex].css;

      const num = document.createElement("div");
      num.className = "knum";
      num.textContent = superCard.value;

      const tag = document.createElement("div");
      tag.className = "tag";
      tag.textContent = "Superkipp";

      k.appendChild(num);
      k.appendChild(tag);

      // Erfolg: Klick auf Karte
      k.addEventListener("click", ()=> superSuccess());

      elSuperWrap.appendChild(k);
    }else{
      elSuperStatus.textContent = "â€“";
    }

    // End check
    if(score >= SCORE_TARGET){
      finalScore.textContent = score;
      overlay.style.display = "flex";
      // disable controls while ended
      btnStart.disabled = true;
      btnSuper.disabled = true;
    }else{
      overlay.style.display = "none";
      btnStart.disabled = false;
    }
  }

  function resetAll(){
    chainColor = null;
    boxCards = [];
    superCard = null;
    score = 0;
    updateUI();
  }

  // Start card: random color + random value
  function generateStartCard(){
    const colorIndex = pickRandomColorIndex(null);
    const value = randInt(1,12);
    chainColor = colorIndex;
    boxCards = [{ value, colorIndex, type: "start" }];
    superCard = null;
    updateUI();
  }

  function onNumberClick(value){
    // If no start card yet -> ignore
    if(chainColor===null || boxCards.length===0) return;

    // In this prototype: number click always adds a "stich" card in chainColor
    boxCards.push({ value, colorIndex: chainColor, type: "stich" });
    updateUI();
  }

  function generateSuperCard(){
    if(chainColor===null || boxCards.length===0) return;
    // Super card must be in another color than chainColor (as per your rule)
    const colorIndex = pickRandomColorIndex(chainColor);
    const value = randInt(1,12);
    superCard = { value, colorIndex };
    updateUI();
  }

  function superSuccess(){
    if(!superCard) return;

    // Super card counts into BoxBot (as you requested)
    boxCards.push({ value: superCard.value, colorIndex: superCard.colorIndex, type: "super" });

    // BoxBot is "won points" when Superkipp succeeds
    const won = boxSum();
    score += won;

    // Reset for new round (new start card possible)
    chainColor = null;
    boxCards = [];
    superCard = null;

    updateUI();
    alert(`Superkipp gelungen! +${won} Punkte`);
  }

  function superFail(){
    if(!superCard) return;

    // Super card disappears
    superCard = null;

    // Remove the bottom (first) card from your own BoxBot
    if(boxCards.length > 1){
      boxCards.shift();
    }else{
      // if only one card -> no penalty
    }

    updateUI();
  }

  // Wire buttons
  btnStart.addEventListener("click", generateStartCard);
  btnSuper.addEventListener("click", generateSuperCard);
  btnReset.addEventListener("click", resetAll);
  xFail.addEventListener("click", superFail);

  btnNewGame.addEventListener("click", ()=>{
    resetAll();
    overlay.style.display = "none";
  });

  // init
  updateUI();
</script>
</body>
</html>
